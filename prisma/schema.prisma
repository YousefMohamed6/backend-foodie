generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [postgis]
}

model User {
  id                       String                      @id @default(uuid())
  firstName                String
  lastName                 String
  email                    String                      @unique
  phoneNumber              String?                     @unique
  countryCode              String?
  password                 String
  profilePictureURL        String?
  fcmToken                 String?                     @unique
  role                     UserRole                    @default(CUSTOMER)
  isDocumentVerify         Boolean                     @default(false)
  zoneId                   String?
  subscriptionPlanId       String?
  subscriptionExpiryDate   DateTime?
  appIdentifier            String?
  provider                 String?
  referralCode             String?                     @unique
  referredBy               String?
  createdAt                DateTime                    @default(now())
  updatedAt                DateTime                    @updatedAt
  vendorId                 String?                     @map("vendor_id")
  isActive                 Boolean                     @default(true) @map("is_active")
  devicePlatform           DevicePlatform?             @map("device_platform")
  preferredLanguage        String?                     @default("ar") @map("preferred_language")
  cashbackRedeems          CashbackRedeem[]
  chatMessages             ChatMessage[]
  customerMetrics          CustomerEngagementMetrics[] @relation("CustomerMetrics")
  customerProfile          CustomerProfile?
  deliveryEvents           DeliveryEvent[]             @relation("DriverDeliveryEvents")
  dineInBookings           DineInBooking[]
  driverMetrics            DriverMetricsSnapshot[]     @relation("DriverMetrics")
  driverProfile            DriverProfile?
  favoriteProducts         FavoriteProduct[]
  favoriteVendors          FavoriteVendor[]
  driverAuditLogs          ManagerAuditLog[]           @relation("DriverManagerLogs")
  managerAuditLogs         ManagerAuditLog[]           @relation("ManagerLogs")
  driverCashConfirmations  ManagerCashConfirmation[]   @relation("DriverCashConfirmations")
  managerCashConfirmations ManagerCashConfirmation[]   @relation("ManagerCashConfirmations")
  adminPayoutConfirmations ManagerPayoutConfirmation[] @relation("AdminPayoutConfirmations")
  managerPayouts           ManagerPayoutConfirmation[] @relation("ManagerPayouts")
  notifications            Notification[]
  ordersAsAuthor           Order[]                     @relation("OrderAuthor")
  ordersAsDriver           Order[]                     @relation("OrderDriver")
  referralsAsReferred      Referral[]                  @relation("Referred")
  referralsAsReferrer      Referral[]                  @relation("Referrer")
  refreshTokens            RefreshToken[]
  reviews                  Review[]
  reviewsAsDriver          Review[]                    @relation("ReviewDriver")
  subscriptionEvents       SubscriptionEventLog[]      @relation("SubscriptionEvents")
  subscriptions            Subscription[]
  activityLogs             UserActivityLog[]
  userGiftCards            UserGiftCard[]
  subscriptionPlan         SubscriptionPlan?           @relation(fields: [subscriptionPlanId], references: [id])
  vendor                   Vendor?                     @relation("UserVendor", fields: [vendorId], references: [id])
  zone                     Zone?                       @relation(fields: [zoneId], references: [id])
  vendorAuthorOf           Vendor?                     @relation("VendorAuthor")
  walletTransactions       WalletTransaction[]
  withdrawMethod           WithdrawMethod?
  chatChannels             ChatChannel[]               @relation("UserChannels")
  withdrawRequests         WithdrawRequest[]
  payoutAccounts           PayoutAccount[]

  @@map("users")
}

model CustomerProfile {
  id           String    @id @default(uuid())
  userId       String    @unique
  walletAmount Decimal   @default(0) @map("wallet_amount") @db.Decimal(10, 2)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  addresses    Address[]
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("customer_profiles")
}

model DriverProfile {
  id            String           @id @default(uuid())
  userId        String           @unique
  isOnline      Boolean          @default(false)
  status        DriverStatus     @default(OFFLINE)
  vehicleType   String?
  licensePlate  String?
  currentLat    Decimal?         @db.Decimal(10, 8)
  currentLng    Decimal?         @db.Decimal(11, 8)
  rotation      Decimal?         @db.Decimal(5, 2)
  carName       String?
  carNumber     String?
  carPictureURL String?
  rating        Decimal          @default(0) @db.Decimal(2, 1)
  totalOrders   Int              @default(0)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  walletAmount  Decimal          @default(0) @map("wallet_amount") @db.Decimal(10, 2)
  documents     DriverDocument[]
  user          User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("driver_profiles")
}

model AdminWallet {
  id           String                @id @default(uuid())
  walletAmount Decimal               @default(0) @map("wallet_amount") @db.Decimal(10, 2)
  updatedAt    DateTime              @updatedAt
  transactions PlatformTransaction[]

  @@map("admin_wallets")
}

model PlatformTransaction {
  id        String      @id @default(uuid())
  walletId  String      @map("wallet_id")
  amount    Decimal     @db.Decimal(10, 2)
  type      String
  reason    String
  orderId   String?     @map("order_id")
  createdAt DateTime    @default(now())
  wallet    AdminWallet @relation(fields: [walletId], references: [id])

  @@map("platform_transactions")
}

model Vendor {
  id                      String                  @id @default(uuid())
  authorId                String                  @unique
  title                   String
  description             String?
  photo                   String?
  logo                    String?
  vendorTypeId            String
  latitude                Decimal                 @db.Decimal(10, 8)
  longitude               Decimal                 @db.Decimal(11, 8)
  address                 String?
  zoneId                  String
  fcmToken                String?
  walletAmount            Decimal                 @default(0) @db.Decimal(10, 2)
  reviewsSum              Decimal                 @default(0) @db.Decimal(10, 2)
  reviewsCount            Int                     @default(0)
  restaurantCost          String?
  subscriptionPlanId      String?
  subscriptionExpiryDate  DateTime?
  createdAt               DateTime                @default(now())
  updatedAt               DateTime                @updatedAt
  isActive                Boolean                 @default(true) @map("is_active")
  isDineInActive          Boolean                 @default(false) @map("is_dine_in_active")
  phoneNumber             String?                 @map("phone_number")
  subscriptionTotalOrders Int?                    @default(0)
  subscriptionProductsLimit Int?                  @default(0) @map("subscription_products_limit")
  subscriptionId          String?
  advertisements          Advertisement[]
  categoriesOwned         Category[]              @relation("CategoryVendor")
  coupons                 Coupon[]
  deliveryEvents          DeliveryEvent[]         @relation("VendorDeliveryEvents")
  dineInBookings          DineInBooking[]
  favoriteVendors         FavoriteVendor[]
  orders                  Order[]
  products                Product[]
  reviews                 Review[]
  stories                 Story[]
  users                   User[]                  @relation("UserVendor")
  commission              VendorCommission?
  restaurantMenuPhotos    VendorMenuPhoto[]
  VendorMetricsSnapshot   VendorMetricsSnapshot[]
  photos                  VendorPhoto[]
  schedules               VendorSchedule[]
  author                  User                    @relation("VendorAuthor", fields: [authorId], references: [id])
  subscription            Subscription?           @relation("VendorSubscription", fields: [subscriptionId], references: [id])
  subscriptionPlan        SubscriptionPlan?       @relation(fields: [subscriptionPlanId], references: [id])
  vendorType              VendorType              @relation(fields: [vendorTypeId], references: [id])
  zone                    Zone                    @relation(fields: [zoneId], references: [id])
  categories              Category[]              @relation("VendorCategories")
  documents               VendorDocument[]
  specialDiscounts        SpecialDiscount[]

  @@map("vendors")
}

model VendorSchedule {
  id        String   @id @default(uuid())
  vendorId  String
  openTime  String?  @map("open_time")
  closeTime String?  @map("close_time")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  dayId     Int      @map("day_id")
  day       WeekDay  @relation(fields: [dayId], references: [id])
  vendor    Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_schedules")
}

model WeekDay {
  id        Int              @id
  nameAr    String           @map("name_ar")
  nameEn    String           @map("name_en")
  schedules VendorSchedule[]

  @@map("week_days")
}

model VendorCommission {
  id        String   @id @default(uuid())
  vendorId  String   @unique
  amount    Decimal  @map("commission_amount") @db.Decimal(10, 2)
  type      String   @default("percentage")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  vendor    Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_commissions")
}

model VendorPhoto {
  id        String   @id @default(uuid())
  url       String   @map("photo")
  vendorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  vendor    Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_photos")
}

model VendorMenuPhoto {
  id        String   @id @default(uuid())
  url       String   @map("photo")
  vendorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  vendor    Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@map("vendor_menu_photos")
}

model Product {
  id               String             @id @default(uuid())
  name             String
  description      String
  price            Decimal            @db.Decimal(10, 2)
  image            String?            @map("photo")
  quantity         Int                @default(0)
  takeawayOption   Boolean            @default(true) @map("takeaway")
  isApprove        Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  categoryId       String?            @map("category_id")
  discountPrice    Decimal?           @map("dis_price") @db.Decimal(10, 2)
  isActive         Boolean            @default(true) @map("is_active")
  isPublish        Boolean            @default(true) @map("is_publish")
  vendorId         String             @map("vendor_id")
  favoriteProducts FavoriteProduct[]
  orderItems       OrderItem[]
  itemAttributes   ProductAttribute[]
  extras           ProductExtra[]
  category         Category?          @relation(fields: [categoryId], references: [id])
  vendor           Vendor             @relation(fields: [vendorId], references: [id])
  reviewsSum       Decimal            @default(0) @db.Decimal(10, 2)
  reviewsCount     Int                @default(0)
  reviews          Review[]

  @@map("products")
}

model ProductExtra {
  id        String   @id @default(uuid())
  name      String
  price     Decimal  @db.Decimal(10, 2)
  productId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_extras")
}

model ProductAttribute {
  id        String   @id @default(uuid())
  productId String
  key       String
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("product_attributes")
}

model Category {
  id               String            @id @default(uuid())
  name             String            @map("title")
  englishName      String?           @map("english_name")
  arabicName       String?           @map("arabic_name")
  description      String?
  descriptionAr    String?           @map("description_ar")
  image            String?           @map("photo")
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  isActive         Boolean           @default(true) @map("is_active")
  showOnHome       Boolean           @default(false) @map("show_on_homepage")
  vendorId         String?           @map("vendor_id")
  vendor           Vendor?           @relation("CategoryVendor", fields: [vendorId], references: [id])
  products         Product[]
  reviewAttributes ReviewAttribute[] @relation("CategoryToReviewAttribute")
  vendors          Vendor[]          @relation("VendorCategories")

  @@map("categories")
}

model Order {
  id                        String                    @id @default(uuid())
  totalAmount               Decimal                   @db.Decimal(10, 2)
  deliveryCharge            Decimal                   @default(0) @db.Decimal(10, 2)
  tipAmount                 Decimal                   @default(0) @map("tip_amount") @db.Decimal(10, 2)
  notes                     String?
  takeAway                  Boolean                   @default(false)
  scheduleTime              DateTime?
  status                    OrderStatus               @default(PLACED)
  createdAt                 DateTime                  @default(now())
  updatedAt                 DateTime                  @updatedAt
  authorId                  String                    @map("author_id")
  driverId                  String?                   @map("driver_id")
  vendorId                  String                    @map("vendor_id")
  paymentMethod             PaymentMethod             @map("payment_method")
  adminCommissionAmount     Decimal                   @default(0) @db.Decimal(10, 2)
  adminCommissionPercentage Decimal                   @default(0) @db.Decimal(10, 2)
  deliveryPricePerKm        Decimal                   @default(0) @db.Decimal(10, 2)
  distanceInKm              Decimal                   @default(0) @db.Decimal(10, 2)
  orderSubtotal             Decimal                   @default(0) @db.Decimal(10, 2)
  orderTotal                Decimal                   @default(0) @db.Decimal(10, 2)
  vendorEarnings            Decimal                   @default(0) @db.Decimal(10, 2)
  addressId                 String?                   @map("address_id")
  cashReportedAt            DateTime?                 @map("cash_reported_at")
  discountAmount            Decimal                   @default(0) @db.Decimal(10, 2)
  paymentStatus             PaymentStatus             @default(UNPAID) @map("payment_status")
  driverCommissionApplied   Boolean                   @default(false) @map("driver_commission_applied")
  driverCommissionRate      Decimal                   @default(0) @map("driver_commission_rate") @db.Decimal(10, 4)
  driverCommissionValue     Decimal                   @default(0) @map("driver_commission_value") @db.Decimal(10, 2)
  driverNet                 Decimal                   @default(0) @map("driver_net") @db.Decimal(10, 2)
  estimatedReadyAt          DateTime?                 @map("estimated_ready_at")
  deliveryOtp               String?                   @map("delivery_otp")
  isReadyNotificationSent   Boolean                   @default(false) @map("is_ready_notification_sent")
  platformTotalCommission   Decimal                   @default(0) @map("platform_total_commission") @db.Decimal(10, 2)
  vendorCommissionApplied   Boolean                   @default(false) @map("vendor_commission_applied")
  vendorCommissionRate      Decimal                   @default(0) @map("vendor_commission_rate") @db.Decimal(10, 4)
  vendorCommissionValue     Decimal                   @default(0) @map("vendor_commission_value") @db.Decimal(10, 2)
  vendorNet                 Decimal                   @default(0) @map("vendor_net") @db.Decimal(10, 2)
  chatChannels              ChatChannel[]
  deliveryEvents            DeliveryEvent[]
  disputes                  Dispute[]
  heldBalance               HeldBalance?
  managerAuditLogs          ManagerAuditLog[]         @relation("OrderManagerLogs")
  managerCashConfirmations  ManagerCashConfirmation[] @relation("OrderCashConfirmations")
  commissionSnapshots       OrderCommissionSnapshot[]
  items                     OrderItem[]
  lifecycleEvents           OrderLifecycleEvent[]
  address                   Address?                  @relation(fields: [addressId], references: [id])
  author                    User                      @relation("OrderAuthor", fields: [authorId], references: [id])
  driver                    User?                     @relation("OrderDriver", fields: [driverId], references: [id])
  vendor                    Vendor                    @relation(fields: [vendorId], references: [id])
  reviews                   Review[]
  walletTransactions        WalletTransaction[]

  @@map("orders")
}

model OrderItem {
  id        String           @id @default(uuid())
  orderId   String
  productId String
  quantity  Int
  price     Decimal          @db.Decimal(10, 2)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  extras    OrderItemExtra[]
  order     Order            @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product          @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model OrderItemExtra {
  id          String    @id @default(uuid())
  name        String
  price       Decimal   @db.Decimal(10, 2)
  orderItemId String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  orderItem   OrderItem @relation(fields: [orderItemId], references: [id], onDelete: Cascade)

  @@map("order_item_extras")
}

model Address {
  id           String          @id @default(uuid())
  label        String
  addressLine1 String
  addressLine2 String?
  latitude     Decimal         @db.Decimal(10, 6)
  longitude    Decimal         @db.Decimal(10, 6)
  isDefault    Boolean         @default(false)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  customerId   String
  customer     CustomerProfile @relation(fields: [customerId], references: [id], onDelete: Cascade)
  orders       Order[]

  @@map("addresses")
}

model VendorType {
  id          String   @id @default(uuid())
  englishName String
  arabicName  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  vendors     Vendor[]

  @@map("vendor_types")
}

model Zone {
  id                     String                   @id @default(uuid())
  area                   Json                     @map("area")
  latitude               Float?
  longitude              Float?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  arabicName             String                   @map("arabic_name")
  englishName            String                   @map("english_name")
  isPublish              Boolean                  @default(true) @map("is_publish")
  users                  User[]
  vendors                Vendor[]
  ZonePerformanceMetrics ZonePerformanceMetrics[]

  @@map("zones")
}

model SubscriptionPlan {
  id            String                @id @default(uuid())
  arabicName    String                @map("arabic_name")
  englishName   String                @map("english_name")
  description   String?
  price         Decimal               @db.Decimal(10, 2)
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  durationDays  Int                   @map("duration_days")
  totalOrders   Int                   @default(0) @map("total_orders")
  isActive      Boolean               @default(true) @map("is_active")
  subscriptions Subscription[]
  users         User[]
  vendors       Vendor[]
  productsLimit Int                   @map("products_limit")
  place         String
  image         String
  type          String
  planPoints    String[]              @map("plan_points")
  features      SubscriptionFeature[]

  @@map("subscription_plans")
}

model SubscriptionFeature {
  id     String           @id @default(uuid())
  key    String
  value  Boolean          @default(true)
  planId String           @map("plan_id")
  plan   SubscriptionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@map("subscription_features")
}

model Subscription {
  id                 String                 @id @default(uuid())
  userId             String
  planId             String
  startDate          DateTime
  endDate            DateTime
  status             SubscriptionStatus     @default(ACTIVE)
  amountPaid         Decimal                @db.Decimal(10, 2)
  paymentMethod      String?
  paymentId          String?
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  eventLogs          SubscriptionEventLog[]
  plan               SubscriptionPlan       @relation(fields: [planId], references: [id])
  user               User                   @relation(fields: [userId], references: [id])
  vendors            Vendor[]               @relation("VendorSubscription")
  walletTransactions WalletTransaction[]

  @@map("subscriptions")
}

model Cashback {
  id             String           @id @default(uuid())
  name           String
  description    String?
  minOrderAmount Decimal          @default(0) @db.Decimal(10, 2)
  expiryDate     DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  type           String           @default("fixed") @map("cashback_type")
  isActive       Boolean          @default(true) @map("is_active")
  amount         Decimal          @default(0) @map("cashback_value") @db.Decimal(10, 2)
  redeems        CashbackRedeem[]

  @@map("cashbacks")
}

model CashbackRedeem {
  id             String   @id @default(uuid())
  userId         String
  cashbackId     String
  orderId        String
  redeemedAmount Decimal  @db.Decimal(10, 2)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  cashback       Cashback @relation(fields: [cashbackId], references: [id])
  user           User     @relation(fields: [userId], references: [id])

  @@map("cashback_redeems")
}

model WalletTransaction {
  id                       String                    @id @default(uuid())
  userId                   String                    @map("user_id")
  amount                   Decimal                   @db.Decimal(10, 2)
  type                     TransactionType?
  paymentMethod            String?                   @map("payment_method")
  orderId                  String?                   @map("order_id")
  subscriptionId           String?                   @map("subscription_id")
  paymentStatus            String?                   @map("payment_status")
  transactionUser          String                    @default("customer")
  referenceId              String?
  metadata                 Json?
  createdAt                DateTime                  @default(now()) @map("date")
  isTopup                  Boolean                   @default(false) @map("is_top_up")
  updatedAt                DateTime                  @updatedAt
  balanceType              BalanceType?              @map("balance_type")
  deliveryConfirmationTime DateTime?                 @map("delivery_confirmation_time")
  deliveryConfirmationType DeliveryConfirmationType? @map("delivery_confirmation_type")
  descriptionAr            String?                   @map("description_ar")
  descriptionEn            String?                   @map("description_en")
  heldBalanceId            String?                   @map("held_balance_id")
  resolutionReason         String?                   @map("resolution_reason")
  heldBalance              HeldBalance?              @relation(fields: [heldBalanceId], references: [id])
  order                    Order?                    @relation(fields: [orderId], references: [id])
  subscription             Subscription?             @relation(fields: [subscriptionId], references: [id])
  user                     User                      @relation(fields: [userId], references: [id])

  @@map("wallet_transactions")
}

model WithdrawMethod {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  config    Json?
  provider  String   @default("stripe")
  user      User     @relation(fields: [userId], references: [id])

  @@map("withdraw_methods")
}

model HeldBalance {
  id                 String                    @id @default(uuid())
  orderId            String                    @unique @map("order_id")
  customerId         String                    @map("customer_id")
  vendorId           String                    @map("vendor_id")
  driverId           String?                   @map("driver_id")
  totalAmount        Decimal                   @map("total_amount") @db.Decimal(10, 2)
  vendorAmount       Decimal                   @map("vendor_amount") @db.Decimal(10, 2)
  driverAmount       Decimal                   @map("driver_amount") @db.Decimal(10, 2)
  adminAmount        Decimal                   @map("admin_amount") @db.Decimal(10, 2)
  status             HeldBalanceStatus         @default(HELD)
  holdReason         String                    @map("hold_reason")
  createdAt          DateTime                  @default(now()) @map("created_at")
  releasedAt         DateTime?                 @map("released_at")
  releaseType        DeliveryConfirmationType? @map("release_type")
  autoReleaseDate    DateTime?                 @map("auto_release_date")
  disputeId          String?                   @map("dispute_id")
  dispute            Dispute?                  @relation(fields: [disputeId], references: [id])
  order              Order                     @relation(fields: [orderId], references: [id])
  walletTransactions WalletTransaction[]

  @@map("held_balances")
}

model Dispute {
  id               String            @id @default(uuid())
  orderId          String            @map("order_id")
  customerId       String            @map("customer_id")
  driverId         String?           @map("driver_id")
  reason           String
  customerEvidence Json?             @map("customer_evidence")
  driverResponse   String?           @map("driver_response")
  driverEvidence   Json?             @map("driver_evidence")
  status           DisputeStatus     @default(PENDING)
  priority         String            @default("MEDIUM")
  assignedTo       String?           @map("assigned_to")
  resolution       String?
  resolutionType   String?           @map("resolution_type")
  createdAt        DateTime          @default(now()) @map("created_at")
  resolvedAt       DateTime?         @map("resolved_at")
  auditLogs        DisputeAuditLog[]
  order            Order             @relation(fields: [orderId], references: [id])
  heldBalances     HeldBalance[]

  @@map("disputes")
}

model DisputeAuditLog {
  id        String   @id @default(uuid())
  disputeId String   @map("dispute_id")
  actorId   String   @map("actor_id")
  actorRole String   @map("actor_role")
  action    String
  oldValue  String?  @map("old_value")
  newValue  String?  @map("new_value")
  reason    String?
  metadata  Json?
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")
  createdAt DateTime @default(now()) @map("created_at")
  dispute   Dispute  @relation(fields: [disputeId], references: [id], onDelete: Cascade)

  @@index([disputeId])
  @@map("dispute_audit_logs")
}

model Coupon {
  id             String   @id @default(uuid())
  code           String   @unique
  description    String?
  discount       String
  image          String?
  discountType   String   @default("percentage")
  maxDiscount    Decimal? @db.Decimal(10, 2)
  minOrderAmount Decimal  @default(0) @db.Decimal(10, 2)
  expiresAt      DateTime
  isPublic       Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  isActive       Boolean  @default(true) @map("is_active")
  vendorId       String?  @map("vendor_id")
  vendor         Vendor?  @relation(fields: [vendorId], references: [id])

  @@map("coupons")
}

model Review {
  productId  String?
  rating     Float
  comment    String?
  driverId   String?
  createdAt  DateTime       @default(now())
  customerId String         @map("customer_id")
  id         String         @id @default(uuid())
  orderId    String?        @map("order_id")
  vendorId   String         @map("vendor_id")
  updatedAt  DateTime       @updatedAt
  images     ReviewImage[]
  ratings    ReviewRating[]
  customer   User           @relation(fields: [customerId], references: [id])
  driver     User?          @relation("ReviewDriver", fields: [driverId], references: [id])
  order      Order?         @relation(fields: [orderId], references: [id])
  product    Product?       @relation(fields: [productId], references: [id])
  vendor     Vendor         @relation(fields: [vendorId], references: [id])

  @@map("reviews")
}

model ReviewImage {
  id        String   @id @default(uuid())
  url       String   @map("photo")
  reviewId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@map("review_images")
}

model DriverDocument {
  id             String        @id @default(uuid())
  status         String        @default("pending")
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  backImage      String?       @map("back_image")
  documentNumber String?       @map("document_number")
  documentType   String        @map("document_type")
  driverId       String        @map("driver_id")
  frontImage     String        @map("front_image")
  driver         DriverProfile @relation(fields: [driverId], references: [id])

  @@map("driver_documents")
}

model ChatChannel {
  id                     String        @id @default(uuid())
  name                   String?
  lastMessageTime        DateTime?
  chatType               String?       @map("chat_type")
  customerId             String?       @map("customer_id")
  customerName           String?       @map("customer_name")
  customerProfileImage   String?       @map("customer_profile_image")
  restaurantId           String?       @map("restaurant_id")
  restaurantName         String?       @map("restaurant_name")
  restaurantProfileImage String?       @map("restaurant_profile_image")
  driverId               String?       @map("driver_id")
  driverName             String?       @map("driver_name")
  driverProfileImage     String?       @map("driver_profile_image")
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  lastMessageText        String?       @map("last_message")
  lastMessageType        String?       @default("TEXT") @map("last_message_type")
  orderId                String?       @map("order_id")
  order                  Order?        @relation(fields: [orderId], references: [id])
  messages               ChatMessage[]
  participants           User[]        @relation("UserChannels")

  @@map("chat_channels")
}

model ChatMessage {
  id             String      @id @default(uuid())
  channelId      String
  senderId       String
  content        String?     @map("message")
  messageType    String      @default("TEXT") @map("message_type")
  filePath       String?     @map("file_path")
  videoThumbnail String?     @map("video_thumbnail")
  receiverId     String?
  orderId        String?
  isRead         Boolean     @default(false) @map("seen")
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  channel        ChatChannel @relation(fields: [channelId], references: [id])
  sender         User        @relation(fields: [senderId], references: [id])

  @@map("chat_messages")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  body      String
  type      String?
  metadata  Json?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@map("notifications")
}

model NotificationTemplate {
  id        String   @id @default(uuid())
  key       String   @unique
  subjectEn String   @map("subject_en")
  subjectAr String   @map("subject_ar")
  bodyEn    String   @map("body_en")
  bodyAr    String   @map("body_ar")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("notification_templates")
}

model Referral {
  id           String   @id @default(uuid())
  referrerId   String
  referredId   String
  rewardAmount Decimal  @default(0) @db.Decimal(10, 2)
  isClaimed    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  referred     User     @relation("Referred", fields: [referredId], references: [id], onDelete: Cascade)
  referrer     User     @relation("Referrer", fields: [referrerId], references: [id], onDelete: Cascade)

  @@map("referrals")
}

model GiftCardTemplate {
  id          String   @id @default(uuid())
  title       String
  description String?
  amount      Decimal  @db.Decimal(10, 2)
  image       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  isActive    Boolean  @default(true) @map("is_active")
  expiryDay   Int?     @default(30)

  @@map("gift_card_templates")
}

model UserGiftCard {
  id         String    @id @default(uuid())
  userId     String
  code       String    @unique
  amount     Decimal   @db.Decimal(10, 2)
  usedAmount Decimal   @default(0) @db.Decimal(10, 2)
  isRedeemed Boolean   @default(false)
  redeemedAt DateTime?
  expiresAt  DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  user       User      @relation(fields: [userId], references: [id])

  @@map("user_gift_cards")
}

model FavoriteVendor {
  id        String   @id @default(uuid())
  userId    String
  vendorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
  vendor    Vendor   @relation(fields: [vendorId], references: [id])

  @@unique([userId, vendorId])
  @@map("favorite_vendors")
}

model FavoriteProduct {
  id        String   @id @default(uuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, productId])
  @@map("favorite_products")
}

model DineInBooking {
  id             String    @id @default(uuid())
  guestPhone     String?
  guestFirstName String?
  guestLastName  String?
  guestEmail     String?
  status         String    @default("pending")
  occasion       String?
  specialRequest String?
  date           DateTime?
  firstVisit     Boolean   @default(false)
  discountType   String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  authorId       String    @map("author_id")
  vendorId       String    @map("vendor_id")
  totalGuest     Int       @default(1)
  discount       Decimal   @default(0) @db.Decimal(10, 2)
  author         User      @relation(fields: [authorId], references: [id])
  vendor         Vendor    @relation(fields: [vendorId], references: [id])

  @@map("dine_in_bookings")
}

model Setting {
  key       String   @id
  value     String
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  @@map("settings")
}

model Story {
  id             String   @id @default(uuid())
  videoThumbnail String?
  mediaType      String   @default("image")
  duration       Int      @default(15)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  vendorId       String   @map("vendor_id")
  mediaUrl       String   @map("video_url")
  isActive       Boolean  @default(true) @map("is_active")
  vendor         Vendor   @relation(fields: [vendorId], references: [id])

  @@map("stories")
}

model Banner {
  id           String   @id @default(uuid())
  title        String
  image        String   @map("photo")
  position     String   @default("top")
  redirectType String?  @map("redirect_type")
  order        Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  redirectId   String?  @map("redirect_id")
  isActive     Boolean  @default(true) @map("is_active")

  @@map("banners")
}

model Advertisement {
  id           String   @id @default(uuid())
  title        String
  description  String?
  image        String   @map("photo")
  redirectType String?  @map("redirect_type")
  redirectUrl  String?
  vendorId     String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  redirectId   String?  @map("redirect_id")
  isActive     Boolean  @default(true) @map("is_active")
  vendor       Vendor?  @relation(fields: [vendorId], references: [id])

  @@map("advertisements")
}

model Tax {
  id        String   @id @default(uuid())
  country   String?
  label     String?
  section   String?
  tax       String?
  type      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true) @map("is_active")

  @@map("taxes")
}

model Currency {
  id        String   @id @default(uuid())
  code      String?
  isAfter   Boolean  @default(false)
  symbol    String?
  decimal   Int      @default(2)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true) @map("is_active")
  isDefault Boolean  @default(false) @map("is_default")

  @@map("currencies")
}

model Language {
  id        String   @id @default(uuid())
  name      String
  code      String   @default("ar")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true) @map("is_active")
  image     String
  isRtl     Boolean  @default(true) @map("is_rtl")
  isDefault Boolean  @default(false) @map("is_default")

  @@map("languages")
}

model EmailTemplate {
  id            String   @id @default(uuid())
  subject       String
  type          String
  message       String
  isSendToAdmin Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("email_templates")
}

model OnBoarding {
  id          String         @id @default(uuid())
  title       String
  description String
  image       String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  type        OnboardingType @default(customerApp)

  @@map("onboarding")
}

model Document {
  id        String   @id @default(uuid())
  title     String
  frontSide Boolean  @default(false)
  backSide  Boolean  @default(false)
  expireAt  Boolean  @default(false)
  enable    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("documents")
}

model Attribute {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("attributes")
}

model ReviewAttribute {
  id         String         @id @default(uuid())
  title      String
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  ratings    ReviewRating[]
  categories Category[]     @relation("CategoryToReviewAttribute")

  @@map("review_attributes")
}

model ReviewRating {
  id          String          @id @default(uuid())
  rating      Int
  reviewId    String
  attributeId String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  attribute   ReviewAttribute @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  review      Review          @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@map("review_ratings")
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  revoked   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deviceId  String?
  userAgent String?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("refresh_tokens")
}

model ManagerAuditLog {
  id        String   @id @default(uuid())
  managerId String   @map("manager_id")
  orderId   String   @map("order_id")
  driverId  String?  @map("driver_id")
  action    String   @default("dispatch")
  createdAt DateTime @default(now())
  driver    User?    @relation("DriverManagerLogs", fields: [driverId], references: [id])
  manager   User     @relation("ManagerLogs", fields: [managerId], references: [id])
  order     Order    @relation("OrderManagerLogs", fields: [orderId], references: [id])

  @@map("manager_audit_logs")
}

model ManagerCashConfirmation {
  id        String   @id @default(uuid())
  managerId String   @map("manager_id")
  driverId  String   @map("driver_id")
  orderId   String   @map("order_id")
  amount    Decimal  @db.Decimal(10, 2)
  createdAt DateTime @default(now())
  driver    User     @relation("DriverCashConfirmations", fields: [driverId], references: [id])
  manager   User     @relation("ManagerCashConfirmations", fields: [managerId], references: [id])
  order     Order    @relation("OrderCashConfirmations", fields: [orderId], references: [id])

  @@map("manager_cash_confirmations")
}

model ManagerPayoutConfirmation {
  id         String   @id @default(uuid())
  managerId  String   @map("manager_id")
  adminId    String   @map("admin_id")
  amount     Decimal  @db.Decimal(10, 2)
  payoutDate DateTime @map("payout_date")
  createdAt  DateTime @default(now())
  admin      User     @relation("AdminPayoutConfirmations", fields: [adminId], references: [id])
  manager    User     @relation("ManagerPayouts", fields: [managerId], references: [id])

  @@map("manager_payout_confirmations")
}

model OrderCommissionSnapshot {
  id              String           @id @default(uuid())
  orderId         String           @map("order_id")
  vendorId        String?          @map("vendor_id")
  driverId        String?          @map("driver_id")
  source          CommissionSource
  commissionRate  Decimal          @map("commission_rate") @db.Decimal(10, 4)
  commissionValue Decimal          @map("commission_value") @db.Decimal(10, 2)
  baseAmount      Decimal          @map("base_amount") @db.Decimal(10, 2)
  createdAt       DateTime         @default(now()) @map("created_at")
  order           Order            @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([vendorId])
  @@index([driverId])
  @@index([source])
  @@index([createdAt])
  @@map("order_commission_snapshots")
}

model UserActivityLog {
  id               String          @id @default(uuid())
  userId           String          @map("user_id")
  activityType     String          @map("activity_type")
  activityCategory String          @map("activity_category")
  resourceType     String?         @map("resource_type")
  resourceId       String?         @map("resource_id")
  sessionId        String?         @map("session_id")
  devicePlatform   DevicePlatform? @map("device_platform")
  appVersion       String?         @map("app_version")
  latitude         Decimal?        @db.Decimal(10, 8)
  longitude        Decimal?        @db.Decimal(11, 8)
  metadata         Json?
  timestamp        DateTime        @default(now())
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([activityType])
  @@index([timestamp])
  @@index([sessionId])
  @@index([resourceType, resourceId])
  @@map("user_activity_logs")
}

model VendorMetricsSnapshot {
  id                    String   @id @default(uuid())
  vendorId              String   @map("vendor_id")
  snapshotDate          DateTime @map("snapshot_date")
  snapshotType          String   @map("snapshot_type")
  totalOrders           Int      @default(0)
  completedOrders       Int      @default(0)
  cancelledOrders       Int      @default(0)
  vendorRejectedOrders  Int      @default(0) @map("vendor_rejected_orders")
  totalRevenue          Decimal  @default(0) @db.Decimal(10, 2)
  netRevenue            Decimal  @default(0) @db.Decimal(10, 2)
  commissionPaid        Decimal  @default(0) @db.Decimal(10, 2)
  averageOrderValue     Decimal  @default(0) @db.Decimal(10, 2)
  averageAcceptanceTime Int?     @map("avg_acceptance_time_seconds")
  acceptanceRate        Decimal? @db.Decimal(5, 2)
  subscriptionPlanId    String?  @map("subscription_plan_id")
  isOnFreePlan          Boolean  @default(false) @map("is_on_free_plan")
  uniqueCustomers       Int      @default(0)
  repeatCustomers       Int      @default(0)
  newCustomers          Int      @default(0)
  activeProducts        Int      @default(0)
  productsOrdered       Int      @default(0)
  totalProductsSold     Int      @default(0) @map("total_products_sold")
  totalDiscountsGiven   Decimal  @default(0) @map("total_discounts_given") @db.Decimal(10, 2)
  createdAt             DateTime @default(now())
  vendor                Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([vendorId, snapshotDate, snapshotType])
  @@index([vendorId])
  @@index([snapshotDate])
  @@index([snapshotType])
  @@map("vendor_metrics_snapshots")
}

model DriverMetricsSnapshot {
  id                  String   @id @default(uuid())
  driverId            String   @map("driver_id")
  snapshotDate        DateTime @map("snapshot_date")
  snapshotType        String   @map("snapshot_type")
  totalAssignments    Int      @default(0)
  acceptedAssignments Int      @default(0)
  rejectedAssignments Int      @default(0)
  completedDeliveries Int      @default(0)
  averageDeliveryTime Int?     @map("avg_delivery_time_minutes")
  averageRating       Decimal? @db.Decimal(2, 1)
  totalRatings        Int      @default(0)
  totalEarnings       Decimal  @default(0) @db.Decimal(10, 2)
  netEarnings         Decimal  @default(0) @db.Decimal(10, 2)
  commissionPaid      Decimal  @default(0) @db.Decimal(10, 2)
  totalTips           Decimal  @default(0) @db.Decimal(10, 2)
  totalOnlineMinutes  Int?     @map("total_online_minutes")
  totalActiveMinutes  Int?     @map("total_active_minutes")
  totalDistanceKm     Decimal? @map("total_distance_km") @db.Decimal(10, 2)
  zoneId              String?
  uniqueVendors       Int      @default(0)
  createdAt           DateTime @default(now())
  driver              User     @relation("DriverMetrics", fields: [driverId], references: [id], onDelete: Cascade)

  @@unique([driverId, snapshotDate, snapshotType])
  @@index([driverId])
  @@index([snapshotDate])
  @@map("driver_metrics_snapshots")
}

model CustomerEngagementMetrics {
  id                   String   @id @default(uuid())
  customerId           String   @map("customer_id")
  snapshotDate         DateTime @map("snapshot_date")
  snapshotType         String   @map("snapshot_type")
  totalOrders          Int      @default(0)
  completedOrders      Int      @default(0)
  cancelledOrders      Int      @default(0)
  totalSpent           Decimal  @default(0) @db.Decimal(10, 2)
  averageOrderValue    Decimal  @default(0) @db.Decimal(10, 2)
  uniqueVendorsOrdered Int      @default(0)
  favoriteVendorId     String?  @map("favorite_vendor_id")
  preferredCategoryId  String?  @map("preferred_category_id")
  daysSinceLastOrder   Int?     @map("days_since_last_order")
  orderFrequency       Decimal? @db.Decimal(5, 2)
  referralsGiven       Int      @default(0)
  reviewsWritten       Int      @default(0)
  walletBalance        Decimal  @default(0) @db.Decimal(10, 2)
  walletTopUps         Int      @default(0)
  createdAt            DateTime @default(now())
  customer             User     @relation("CustomerMetrics", fields: [customerId], references: [id], onDelete: Cascade)

  @@unique([customerId, snapshotDate, snapshotType])
  @@index([customerId])
  @@index([snapshotDate])
  @@map("customer_engagement_metrics")
}

model SubscriptionEventLog {
  id             String       @id @default(uuid())
  subscriptionId String       @map("subscription_id")
  vendorId       String?      @map("vendor_id")
  userId         String       @map("user_id")
  eventType      String       @map("event_type")
  previousPlanId String?      @map("previous_plan_id")
  newPlanId      String       @map("new_plan_id")
  planName       String       @map("plan_name")
  planPrice      Decimal      @db.Decimal(10, 2)
  amountPaid     Decimal      @db.Decimal(10, 2)
  paymentMethod  String?
  paymentStatus  String?
  startDate      DateTime
  endDate        DateTime
  metadata       Json?
  eventTimestamp DateTime     @default(now())
  subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  user           User         @relation("SubscriptionEvents", fields: [userId], references: [id])

  @@index([subscriptionId])
  @@index([userId])
  @@index([vendorId])
  @@index([eventType])
  @@index([eventTimestamp])
  @@map("subscription_event_logs")
}

model PaymentTransactionLog {
  id                   String    @id @default(uuid())
  transactionType      String    @map("transaction_type")
  referenceId          String    @map("reference_id")
  referenceType        String    @map("reference_type")
  userId               String    @map("user_id")
  userRole             UserRole  @map("user_role")
  amount               Decimal   @db.Decimal(10, 2)
  currency             String    @default("EGP")
  paymentMethod        String    @map("payment_method")
  paymentGateway       String?   @map("payment_gateway")
  status               String
  previousStatus       String?   @map("previous_status")
  gatewayTransactionId String?   @map("gateway_transaction_id")
  gatewayResponse      Json?     @map("gateway_response")
  errorCode            String?   @map("error_code")
  errorMessage         String?   @map("error_message")
  initiatedAt          DateTime  @default(now()) @map("initiated_at")
  completedAt          DateTime? @map("completed_at")
  metadata             Json?

  @@index([userId])
  @@index([referenceId])
  @@index([status])
  @@index([paymentMethod])
  @@index([initiatedAt])
  @@map("payment_transaction_logs")
}

model PlatformMetricsSummary {
  id                    String   @id @default(uuid())
  summaryDate           DateTime @map("summary_date")
  summaryType           String   @map("summary_type")
  totalOrders           Int      @default(0)
  completedOrders       Int      @default(0)
  cancelledOrders       Int      @default(0)
  averageOrderValue     Decimal  @default(0) @db.Decimal(10, 2)
  grossMerchandiseValue Decimal  @default(0) @map("gmv") @db.Decimal(10, 2)
  totalRevenue          Decimal  @default(0) @db.Decimal(10, 2)
  vendorCommissions     Decimal  @default(0) @db.Decimal(10, 2)
  driverCommissions     Decimal  @default(0) @db.Decimal(10, 2)
  platformRevenue       Decimal  @default(0) @db.Decimal(10, 2)
  subscriptionRevenue   Decimal  @default(0) @db.Decimal(10, 2)
  activeCustomers       Int      @default(0)
  activeVendors         Int      @default(0)
  activeDrivers         Int      @default(0)
  newCustomers          Int      @default(0)
  newVendors            Int      @default(0)
  newDrivers            Int      @default(0)
  totalSearches         Int      @default(0)
  totalReviews          Int      @default(0)
  createdAt             DateTime @default(now())

  @@unique([summaryDate, summaryType])
  @@index([summaryDate])
  @@map("platform_metrics_summaries")
}

model ZonePerformanceMetrics {
  id                     String   @id @default(uuid())
  zoneId                 String   @map("zone_id")
  snapshotDate           DateTime @map("snapshot_date")
  snapshotType           String   @map("snapshot_type")
  totalOrders            Int      @default(0)
  completedOrders        Int      @default(0)
  averageDeliveryTime    Int?     @map("avg_delivery_time_minutes")
  totalRevenue           Decimal  @default(0) @db.Decimal(10, 2)
  averageOrderValue      Decimal  @default(0) @db.Decimal(10, 2)
  activeVendors          Int      @default(0)
  activeDrivers          Int      @default(0)
  totalCustomers         Int      @default(0)
  managerId              String?  @map("manager_id")
  totalDriverAssignments Int      @default(0)
  cashCollections        Decimal  @default(0) @db.Decimal(10, 2)
  createdAt              DateTime @default(now())
  zone                   Zone     @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@unique([zoneId, snapshotDate, snapshotType])
  @@index([zoneId])
  @@index([snapshotDate])
  @@map("zone_performance_metrics")
}

model ProductPerformanceMetrics {
  id                 String   @id @default(uuid())
  productId          String   @map("product_id")
  vendorId           String   @map("vendor_id")
  snapshotDate       DateTime @map("snapshot_date")
  snapshotType       String   @map("snapshot_type")
  totalOrders        Int      @default(0)
  totalQuantitySold  Int      @default(0)
  totalRevenue       Decimal  @default(0) @db.Decimal(10, 2)
  averagePrice       Decimal  @default(0) @db.Decimal(10, 2)
  totalDiscountGiven Decimal  @default(0) @db.Decimal(10, 2)
  uniqueCustomers    Int      @default(0)
  totalViews         Int      @default(0)
  totalFavorites     Int      @default(0)
  conversionRate     Decimal? @map("conversion_rate") @db.Decimal(5, 2)
  createdAt          DateTime @default(now())

  @@unique([productId, snapshotDate, snapshotType])
  @@index([productId])
  @@index([vendorId])
  @@index([snapshotDate])
  @@map("product_performance_metrics")
}

model EntityChangeLog {
  id            String    @id @default(uuid())
  entityType    String    @map("entity_type")
  entityId      String    @map("entity_id")
  changeType    String    @map("change_type")
  actorId       String?   @map("actor_id")
  actorRole     UserRole? @map("actor_role")
  previousValue Json?     @map("previous_value")
  newValue      Json?     @map("new_value")
  changedFields String[]  @map("changed_fields")
  ipAddress     String?   @map("ip_address")
  userAgent     String?   @map("user_agent")
  timestamp     DateTime  @default(now())

  @@index([entityType, entityId])
  @@index([actorId])
  @@index([changeType])
  @@index([timestamp])
  @@map("entity_change_logs")
}

model OrderLifecycleEvent {
  id                String    @id @default(uuid())
  orderId           String    @map("order_id")
  eventType         String    @map("event_type")
  previousStatus    String?   @map("previous_status")
  newStatus         String?   @map("new_status")
  actorId           String?   @map("actor_id")
  actorRole         UserRole? @map("actor_role")
  timeSincePrevious Int?      @map("time_since_previous")
  locationLat       Float?    @map("location_lat")
  locationLng       Float?    @map("location_lng")
  metadata          Json?
  eventTimestamp    DateTime  @default(now()) @map("event_timestamp")
  order             Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([eventType])
  @@index([eventTimestamp])
  @@map("order_lifecycle_events")
}

model DeliveryEvent {
  id              String   @id @default(uuid())
  orderId         String   @map("order_id")
  driverId        String   @map("driver_id")
  vendorId        String   @map("vendor_id")
  eventType       String   @map("event_type")
  status          String
  latitude        Float
  longitude       Float
  distanceCovered Float?   @map("distance_covered")
  duration        Int?
  averageSpeed    Float?   @map("average_speed")
  metadata        Json?
  eventTimestamp  DateTime @default(now()) @map("event_timestamp")
  driver          User     @relation("DriverDeliveryEvents", fields: [driverId], references: [id])
  order           Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  vendor          Vendor   @relation("VendorDeliveryEvents", fields: [vendorId], references: [id])

  @@index([orderId])
  @@index([driverId])
  @@index([vendorId])
  @@index([eventTimestamp])
  @@map("delivery_events")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

enum UserRole {
  CUSTOMER @map("customer")
  VENDOR   @map("vendor")
  DRIVER   @map("driver")
  ADMIN    @map("admin")
  MANAGER  @map("manager")
}

enum DevicePlatform {
  ANDROID @map("android")
  IOS     @map("ios")
  WEB     @map("web")
}

enum PaymentMethod {
  wallet
  card
  cash
  online
}

enum PaymentStatus {
  UNPAID @map("unpaid")
  PAID   @map("paid")
}

enum OnboardingType {
  driverApp
  customerApp
  vendorApp
  mangerApp
}

enum OrderStatus {
  PLACED          @map("Order Placed")
  VENDOR_ACCEPTED @map("Vendor Accepted")
  VENDOR_REJECTED @map("Vendor Rejected")
  CANCELLED       @map("Order Cancelled")
  DRIVER_PENDING  @map("Driver Pending")
  DRIVER_ACCEPTED @map("Driver Accepted")
  DRIVER_REJECTED @map("Driver Rejected")
  SHIPPED         @map("Order Shipped")
  IN_TRANSIT      @map("In Transit")
  COMPLETED       @map("Order Completed")
}

enum CommissionSource {
  VENDOR @map("vendor")
  DRIVER @map("driver")
}

enum SubscriptionStatus {
  ACTIVE    @map("active")
  EXPIRED   @map("expired")
  CANCELLED @map("cancelled")
}

enum TransactionType {
  DEPOSIT    @map("deposit")
  WITHDRAWAL @map("withdrawal")
  PAYMENT    @map("payment")
  REFUND     @map("refund")
}

enum BalanceType {
  PAYMENT  @map("payment")
  HELD     @map("held")
  RELEASED @map("released")
  REFUNDED @map("refunded")
}

enum DeliveryConfirmationType {
  CUSTOMER_CONFIRMATION @map("customer_confirmation")
  OTP_CONFIRMED         @map("otp_confirmed")
  PHOTO_PROOF           @map("photo_proof")
  TIMEOUT_RELEASE       @map("timeout_release")
  ADMIN_RESOLUTION      @map("admin_resolution")
}

enum HeldBalanceStatus {
  HELD     @map("held")
  RELEASED @map("released")
  REFUNDED @map("refunded")
  DISPUTED @map("disputed")
}

enum DisputeStatus {
  PENDING               @map("pending")
  UNDER_REVIEW          @map("under_review")
  RESOLVED_CUSTOMER_WIN @map("resolved_customer_win")
  RESOLVED_DRIVER_WIN   @map("resolved_driver_win")
  RESOLVED_PARTIAL      @map("resolved_partial")
  FRAUD_DETECTED        @map("fraud_detected")
}

enum DriverStatus {
  AVAILABLE @map("Available")
  BUSY      @map("Busy")
  OFFLINE   @map("Offline")
}

enum SupportMessageType {
  TEXT  @map("text")
  IMAGE @map("image")
  VIDEO @map("video")
}

model SupportInbox {
  id               String             @id @default(uuid())
  userId           String             @map("user_id")
  userName         String             @map("user_name")
  userProfileImage String?            @map("user_profile_image")
  adminId          String?            @map("admin_id")
  adminName        String?            @map("admin_name")
  lastMessage      String?            @map("last_message")
  lastMessageType  SupportMessageType @default(TEXT) @map("last_message_type")
  lastSenderId     String?            @map("last_sender_id")
  isRead           Boolean            @default(false) @map("is_read")
  createdAt        DateTime           @default(now()) @map("created_at")
  updatedAt        DateTime           @updatedAt @map("updated_at")
  messages         SupportMessage[]

  @@map("support_inboxes")
}

model SupportMessage {
  id             String             @id @default(uuid())
  inboxId        String             @map("inbox_id")
  senderId       String             @map("sender_id")
  senderName     String             @map("sender_name")
  senderRole     String             @map("sender_role")
  type           SupportMessageType @default(TEXT)
  message        String?
  filePath       String?            @map("file_path")
  videoThumbnail String?            @map("video_thumbnail")
  createdAt      DateTime           @default(now()) @map("created_at")
  inbox          SupportInbox       @relation(fields: [inboxId], references: [id], onDelete: Cascade)

  @@index([inboxId])
  @@map("support_messages")
}


enum WithdrawStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
  FAILED
}

enum WithdrawalMethod {
  MANUAL
  BANK
  INSTAPAY
  VODAFONE_CASH
}

model WithdrawRequest {
  id              String   @id @default(uuid())
  userId          String
  amount          Decimal  @db.Decimal(10, 2)
  status          WithdrawStatus @default(PENDING)
  method          WithdrawalMethod
  accountDetails  Json?
  referenceId     String?
  adminNotes      String?
  snapshotBalance Decimal? @db.Decimal(10, 2)
  payoutAccountId String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  processedAt     DateTime?
  completedAt     DateTime?
  rejectedAt      DateTime?
  failedAt        DateTime?

  user           User           @relation(fields: [userId], references: [id])
  payoutAccount  PayoutAccount? @relation(fields: [payoutAccountId], references: [id])
  
  @@map("withdraw_requests")
}

model PayoutAccount {
  id          String           @id @default(uuid())
  userId      String           @map("user_id")
  method      WithdrawalMethod
  details     Json             @map("details") // Stores { accountNumber, bankName, etc. }
  isDefault   Boolean          @default(false) @map("is_default")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt      @map("updated_at")

  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  withdrawRequests WithdrawRequest[]

  @@map("payout_accounts")
}

model VendorDocument {
  id             String   @id @default(uuid())
  vendorId       String   @map("vendor_id")
  documentId     String   @map("document_id")
  frontImage     String?  @map("front_image")
  backImage      String?        @map("back_image")
  status         DocumentStatus @default(PENDING)
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")
  vendor         Vendor         @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([vendorId, documentId])
  @@map("vendor_documents")
}

enum DocumentStatus {
  PENDING  @map("pending")
  ACCEPTED @map("accepted")
  REJECTED @map("rejected")
}


model SpecialDiscount {
  id                String          @id @default(uuid())
  vendorId          String          @map("vendor_id")
  vendor            Vendor          @relation(fields: [vendorId], references: [id])
  endDate           DateTime
  discount          Decimal         @db.Decimal(10, 2)
  couponCode        String          @map("coupon_code")
  photo             String          @map("photo")
  discountType      DiscountType    @default(PERCENTAGE) @map("discount_type")
  enable            Boolean         @default(false)
  public            Boolean         @default(false)
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")

  @@map("special_discounts")
}

enum DiscountType {
  PERCENTAGE @map("percentage")
  FIXED      @map("fixed")
}
